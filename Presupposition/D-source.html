<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>D.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE
<a name="line-2"></a>    TypeFamilies,
<a name="line-3"></a>    FlexibleContexts,
<a name="line-4"></a>    InstanceSigs #-}</span>
<a name="line-5"></a>
<a name="line-6"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>D</span> <span class='hs-keyword'>where</span>
<a name="line-7"></a>
<a name="line-8"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Prelude</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monad</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;*&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>head</span><span class='hs-layout'>,</span> <span class='hs-varid'>tail</span><span class='hs-layout'>)</span>
<a name="line-9"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Effect</span>
<a name="line-10"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Model</span>
<a name="line-11"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>InfoStates</span>
<a name="line-12"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>P</span>
<a name="line-13"></a>
<a name="line-14"></a><span class='hs-comment'>-- $intro</span>
<a name="line-15"></a><span class='hs-comment'>-- This module defines, from 'P', a datatype constructor 'D' for representing</span>
<a name="line-16"></a><span class='hs-comment'>-- presupposition and defines from it an instance of the 'Effect' class of</span>
<a name="line-17"></a><span class='hs-comment'>-- Orchard, Petricek, and Mycroft. The result is an implementation of the</span>
<a name="line-18"></a><span class='hs-comment'>-- framework for presupposition of chapter 3 of Grove 2019.</span>
<a name="line-19"></a>
<a name="line-20"></a><a name="D"></a><span class='hs-comment'>-- | We define a datatype 'D' for dynamic presupposition. 'D' takes 'P' and</span>
<a name="line-21"></a><a name="D"></a><span class='hs-comment'>-- implicitly gives it 'ReaderT' functionality so that it is sensitive to the</span>
<a name="line-22"></a><a name="D"></a><span class='hs-comment'>-- discourse context, as well as 'StateT' functionality so that it is sensitive</span>
<a name="line-23"></a><a name="D"></a><span class='hs-comment'>-- to an incoming index.</span>
<a name="line-24"></a><a name="D"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>D</span> <span class='hs-varid'>e</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>D</span> <span class='hs-layout'>{</span> <span class='hs-varid'>runD</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>InfoState</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>InfoState</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>P</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-25"></a>
<a name="line-26"></a><a name="instance%20Effect%20D"></a><span class='hs-comment'>-- | We make 'D' an instance of the 'Effect' class of Orchard, Petricek, and</span>
<a name="line-27"></a><a name="instance%20Effect%20D"></a><span class='hs-comment'>-- Mycroft. Indeed, the effects are the same as those of 'P'.</span>
<a name="line-28"></a><a name="instance%20Effect%20D"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Effect</span> <span class='hs-conid'>D</span> <span class='hs-keyword'>where</span>
<a name="line-29"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>Inv</span> <span class='hs-conid'>D</span> <span class='hs-varid'>p1</span> <span class='hs-varid'>p2</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SeqSplit</span> <span class='hs-varid'>p1</span> <span class='hs-varid'>p2</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>p1</span> <span class='hs-varid'>p2</span><span class='hs-layout'>)</span>
<a name="line-30"></a>
<a name="line-31"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>Unit</span> <span class='hs-conid'>D</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>()</span>
<a name="line-32"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>Plus</span> <span class='hs-conid'>D</span> <span class='hs-varid'>p1</span> <span class='hs-varid'>p2</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>p1</span> <span class='hs-varid'>p2</span>
<a name="line-33"></a>
<a name="line-34"></a>  <span class='hs-varid'>return</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>D</span> <span class='hs-conid'>()</span> <span class='hs-varid'>a</span>
<a name="line-35"></a>  <span class='hs-varid'>return</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>D</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-36"></a>
<a name="line-37"></a>  <span class='hs-layout'>(</span><span class='hs-varop'>&gt;&gt;=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SeqSplit</span> <span class='hs-varid'>e</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>e</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-38"></a>           <span class='hs-conid'>D</span> <span class='hs-varid'>e</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>D</span> <span class='hs-varid'>f</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>D</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>e</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span>
<a name="line-39"></a>  <span class='hs-varid'>m</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>D</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>runD</span> <span class='hs-varid'>m</span> <span class='hs-varid'>i</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>v</span><span class='hs-layout'>,</span> <span class='hs-varid'>j</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>runD</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-varid'>j</span> <span class='hs-varid'>c</span>
<a name="line-40"></a>
<a name="line-41"></a><a name="instance%20Functor%20(D%20e)"></a><span class='hs-comment'>-- | For any given effect, 'D' constitutes a 'Functor'.</span>
<a name="line-42"></a><a name="instance%20Functor%20(D%20e)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Functor</span> <span class='hs-layout'>(</span><span class='hs-conid'>D</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-43"></a>  <span class='hs-varid'>fmap</span> <span class='hs-varid'>f</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>D</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>j</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>j</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>runD</span> <span class='hs-varid'>m</span> <span class='hs-varid'>i</span> <span class='hs-varid'>c</span>
<a name="line-44"></a>
<a name="line-45"></a><a name="%3e%3e%3e="></a><span class='hs-comment'>-- | We define a makeshift graded bind so as to provide a non-conflicting</span>
<a name="line-46"></a><span class='hs-comment'>-- identifier for use outside the current module.</span>
<a name="line-47"></a><span class='hs-layout'>(</span><span class='hs-varop'>&gt;&gt;&gt;=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SeqSplit</span> <span class='hs-varid'>e</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>e</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>D</span> <span class='hs-varid'>e</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>D</span> <span class='hs-varid'>f</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>D</span> <span class='hs-layout'>(</span><span class='hs-conid'>Plus</span> <span class='hs-conid'>D</span> <span class='hs-varid'>e</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span>
<a name="line-48"></a><span class='hs-layout'>(</span><span class='hs-varop'>&gt;&gt;&gt;=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;&gt;=</span><span class='hs-layout'>)</span>
<a name="line-49"></a>
<a name="line-50"></a><a name="upD"></a><span class='hs-comment'>-- | The graded monad operator 'upD' is just 'return'.</span>
<a name="line-51"></a><span class='hs-definition'>upD</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>D</span> <span class='hs-conid'>()</span> <span class='hs-varid'>a</span>
<a name="line-52"></a><span class='hs-definition'>upD</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varid'>a</span>
<a name="line-53"></a>
<a name="line-54"></a><a name="downD"></a><span class='hs-comment'>-- | The graded monad operator 'downD' is just sequential application.</span>
<a name="line-55"></a><span class='hs-definition'>downD</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SeqSplit</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>f</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>f</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-56"></a>          <span class='hs-conid'>SeqSplit</span> <span class='hs-varid'>f</span> <span class='hs-conid'>()</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>f</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-57"></a>         <span class='hs-conid'>D</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>D</span> <span class='hs-varid'>f</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>D</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>f</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span>
<a name="line-58"></a><span class='hs-definition'>downD</span> <span class='hs-varid'>u</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>u</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>v</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-59"></a>
<a name="line-60"></a><a name="joinD"></a><span class='hs-comment'>-- | The graded monad operator 'joinD' is just join.</span>
<a name="line-61"></a><span class='hs-definition'>joinD</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SeqSplit</span> <span class='hs-varid'>e</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>e</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>D</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>D</span> <span class='hs-varid'>f</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>D</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>e</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span>
<a name="line-62"></a><span class='hs-definition'>joinD</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>id</span>
<a name="line-63"></a>
<a name="line-64"></a><a name="anaph"></a><span class='hs-comment'>-- | We implement anaphora resolution via a function 'anaph', which takes a</span>
<a name="line-65"></a><span class='hs-comment'>-- position to plug, a term with which to plug it, and the effectual meaning</span>
<a name="line-66"></a><span class='hs-comment'>-- undergoing anaphora.</span>
<a name="line-67"></a><span class='hs-definition'>anaph</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NatWitness</span> <span class='hs-varid'>n</span>
<a name="line-68"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-69"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>D</span> <span class='hs-layout'>(</span><span class='hs-conid'>Insert</span> <span class='hs-layout'>(</span><span class='hs-conid'>NatWitness</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span>
<a name="line-70"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>D</span> <span class='hs-varid'>e</span> <span class='hs-varid'>b</span>
<a name="line-71"></a><span class='hs-definition'>anaph</span> <span class='hs-varid'>i</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>D</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>j</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>preAnaph</span> <span class='hs-varid'>i</span> <span class='hs-varid'>a</span> <span class='hs-varop'>$</span> <span class='hs-varid'>runD</span> <span class='hs-varid'>m</span> <span class='hs-varid'>j</span> <span class='hs-varid'>c</span>
<a name="line-72"></a>
<a name="line-73"></a><a name="the"></a><span class='hs-comment'>-- | Let's define a dynamic meaning for _the_.</span>
<a name="line-74"></a><span class='hs-definition'>the</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Lift</span> <span class='hs-layout'>(</span><span class='hs-conid'>Entity</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>D</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lift</span> <span class='hs-conid'>Entity</span><span class='hs-layout'>,</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lift</span> <span class='hs-conid'>Entity</span><span class='hs-layout'>)</span>
<a name="line-75"></a><span class='hs-definition'>the</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>D</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>P</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>isTrue</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span> <span class='hs-varop'>$</span> <span class='hs-varid'>p</span> <span class='hs-varop'>$</span> <span class='hs-varid'>head</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-varop'>||-</span> <span class='hs-layout'>(</span><span class='hs-varid'>head</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-76"></a>
<a name="line-77"></a><a name="%3e@"></a><span class='hs-comment'>-- | We define a function '&gt;@' for dynamic discourse update.</span>
<a name="line-78"></a><span class='hs-layout'>(</span><span class='hs-varop'>&gt;@</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SeqSplit</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>f</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>f</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-79"></a>         <span class='hs-conid'>SeqSplit</span> <span class='hs-varid'>f</span> <span class='hs-conid'>()</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>f</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-80"></a>        <span class='hs-conid'>D</span> <span class='hs-varid'>e</span> <span class='hs-conid'>InfoState</span>
<a name="line-81"></a>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>D</span> <span class='hs-varid'>f</span> <span class='hs-conid'>InfoState</span>
<a name="line-82"></a>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>D</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonoidPlus</span> <span class='hs-varid'>f</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-conid'>InfoState</span>
<a name="line-83"></a><a name="phi"></a><span class='hs-definition'>phi</span> <span class='hs-varop'>&gt;@</span> <span class='hs-varid'>psi</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>phi</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>D</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>runD</span> <span class='hs-varid'>psi</span> <span class='hs-varid'>i</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-varid'>p</span> <span class='hs-varop'>=&gt;&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&gt;&gt;=</span>
<a name="line-84"></a>                       <span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>q</span><span class='hs-layout'>,</span> <span class='hs-varid'>j</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>p</span> <span class='hs-varop'>&gt;+</span> <span class='hs-varid'>q</span><span class='hs-layout'>,</span> <span class='hs-varid'>j</span><span class='hs-layout'>)</span>
<a name="line-85"></a>
<a name="line-86"></a><a name="reset"></a><span class='hs-comment'>-- | We can 'reset' meanings by plugging in the identity context 'id' and</span>
<a name="line-87"></a><span class='hs-comment'>-- plugging any reference to an incoming state with '0'.</span>
<a name="line-88"></a><span class='hs-definition'>reset</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>D</span> <span class='hs-varid'>e</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>D</span> <span class='hs-varid'>e</span> <span class='hs-varid'>a</span>
<a name="line-89"></a><span class='hs-definition'>reset</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>D</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>v</span><span class='hs-layout'>,</span> <span class='hs-varid'>j</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>v</span><span class='hs-layout'>,</span> <span class='hs-varid'>i</span> <span class='hs-varop'>+</span> <span class='hs-varid'>j</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>runD</span> <span class='hs-varid'>m</span> <span class='hs-num'>0</span> <span class='hs-varid'>id</span>
<a name="line-90"></a>
<a name="line-91"></a><a name="unWrap"></a><span class='hs-comment'>-- | We define a function to 'unWrap' a meaning and see what value it might be</span>
<a name="line-92"></a><span class='hs-comment'>-- holding (something in the 'Maybe' monad).</span>
<a name="line-93"></a><span class='hs-definition'>unWrap</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>D</span> <span class='hs-conid'>()</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span>
<a name="line-94"></a><span class='hs-definition'>unWrap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>fst</span> <span class='hs-varop'>$</span> <span class='hs-varid'>runP</span> <span class='hs-layout'>(</span><span class='hs-varid'>runD</span> <span class='hs-varid'>m</span> <span class='hs-num'>0</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-conid'>End</span>
<a name="line-95"></a>
<a name="line-96"></a><a name="checkForTruth"></a><span class='hs-comment'>-- | We define a function 'checkForTruth' to check whether or not a trivially</span>
<a name="line-97"></a><span class='hs-comment'>-- effectual information state is 'Just True', 'Just False', or 'Nothing'.</span>
<a name="line-98"></a><span class='hs-definition'>checkForTruth</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>D</span> <span class='hs-conid'>()</span> <span class='hs-conid'>InfoState</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Bool</span>
<a name="line-99"></a><span class='hs-definition'>checkForTruth</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>isTrue</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-varid'>true</span> <span class='hs-varop'>=&gt;&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>unWrap</span> <span class='hs-varid'>m</span>
</pre></body>
</html>
